perl parts_01.pl

要作成	-----------------------------------------------------
standard.opf
navigation-documents.xhtml

p-cover.xhtml			カバー
p-titlepage.xhtml		タイトルページ
p-toc.xhtml				目次ページ
p-colophon.xhtml		奥付

p-001.xhtml
p-002.xhtml
p-ad-001.xhtml


段取り	-----------------------------------------------------
InDesign	
ok			・目次と本体を見て、構造（階層）を判断
ok			・必要なスタイルを付ける（目次_章・目次_節など、階層によって別名に）
ok			・ノンブルは削除
ok			・目次はファイル内リンクを作成
未			・テキストボックスまたはスタイルによって英数字の回転をしている。そこはどうするか？
go				→　InDesign上で検索・テキストに縦中横の処置？（出力してタグ（半角英数字）が付く前に）
NG				→　html上で、正規表現で英数字の検索・置換？（あるいはタグ抜きテキストで）
ok			・htmlで書き出し
未			・画像ページ作成（画像ページをPDF（かjpg）出力。

html　→　調整html
		・01スクリプトで作業か？
		・同時に、タグ抜きhtmlも出力
		・カット位置、タグをカット位置指定とする
			目次とか奥付とか	<div class="_idGen　・・・・<!-- filename_●● -->
			テキスト系ページ	<div class="_idGenStoryDirection-●"
			画像系ページ		<div class="_idGenObjectLayout-●">
		・画像ページ
			いろいろな画像やキャプションのあるページは、
			InDesign時にページ画像（PDFから切り出し）にして貼り換え、
			書き出した時にはシンプルになっているようにする。
				→　実画像は03_materials/imageにセット
		・体裁
			ルビ・縦中横、インデント（下揃え、注釈、小書き、etc）
				何があるか、事前に把握要
			奥付	各社ごとに用意


変換
半	書誌読み取り
ok	元html読み取り
ok	テンプレート読み取り
未		→　テンプレ多数
			注意点
	XHTML変換	
確認	・方向がページごとに違うことあり
ok		・画像ページと本文ページのテンプレートを使い分け、
ok		　出力ファイル名カウンターは共通
ok		・xhtmlヘッダーに各種●囲みの要素文字変換
ok			ページ方向
ok			タイトル名
ok			bodyにページ毎のクラスが入る
ok			最初のdivタグにtocのidが入ることがある
半				なければ●＿●を削除する必要。
ok		・特定のタグを見つけ、テンプレートに落とし込み、xhtmlで出力
ok			同時に、目次idを把握、XHTML名を、目次部分のxhtml名に書き換え
ok			→　繰り返し、ファイルに連番をつけて出力

未	目次の整形
		元のhtmlの目次部分をカットし、定型名の1ファイルにペースト
		↓
ok		→	p-toc.html

ok		→	navigation_documentの生成

ok	奥付の整形
		版元のテンプレに依るなあ・・・
		サンプルで来たものだけテンプレ化と、運用は手動な気がする・・・
		
未	注釈づくり（戻りができる）
		<a class="noteref" id="noteref-001" href="p-cyushaku.xhtml#note-001">
		<a class="note" id="note-001" href="p-002.xhtml#noteref-001">
		
ok	注釈のnotefdのスタイルが、html書き出しの方を参照してしまう
		→　htmlソースフォルダを不要（外し）で良いようだ。
		
未	noteリンクのスクリプトと、細かい文字修正のタイミング、順番が確立していない
		→　少なくとも、tcyやルビタグと合わせ、noteタグを整備（数合わせも）しないとリンクのスクリプトはかけられない。
		
ok	注釈（noteリンク）は、同一の分割xhtmlファイルなら変換ができるようになった。
未	が、注釈本文が別ページに置かれるパターン（例：巻末や章末の「注釈」ページ）には、対応ができていない。（ページファイル名が変わる）
	どう制御すべきか？？？
		＜整理＞そもそも、元データ（InDesign）が上記構造となっている。
					・idナンバー付け自体は現行で問題ない。
					・本文注釈のリンク先が不明、単体ページ（巻末）か複数かも（章末）
					・注釈頁に、注釈元のxhtmlファイル名を記載することは可能？？？？
						note、noterefに番号振りをする機能（03_adjust_link.pl）に仕掛けが必要か？
		＜案＞書誌で、「注釈頁」（要不要）みたいな項目列を作る。
				チェックが入っていたら、05_authoring_25.pl変換の分岐。
					noteref-001		←　<a class="noteref" href="adjust_target.xhtml#note-001" id="noteref-001">を配列化
					note-001		←　<a class="note" href="adjust_target.xhtml#noteref-001" id="note-001">をを配列化
					（単体（巻末）の注釈頁パターン）
							・リンク先をannotationページのリンクに統一
							・annotationページのxhtmlを出力する？　注釈ページの明示と、それを読み取っての分岐処理
							（連番処理（カウント）を抜けてannotation、その次に連番が継続するかも）
					（複数（章末など）の注釈頁パターン）
							・chap1_annotationページを作る、IDもchap毎。

未	01_convert_target.plで、書誌に「目次有」なら目次用テンプレートファイルをコピペ、とした方がいい。
未	01_convert_target.plで、巻末注釈頁アリなら注釈用テンプレートファイルを……以下同。（テンプレートは未だ用意していない）
			→　目次と同じく、区切りのエスケープ行を用意とか、手動で注釈ページ内容をカッペしなければいけない
			→　04_assenble.plにも05_authoring.plにも注釈ファイルの処理を加える必要あり。（無いときにはスルーも）
			
未	書誌に目次有無を入れているのに、無かった場合の処理を入れてないのでは？
		navigationはどう書かれるべきなのか？
		tocはどう書かれるべきなのか？


整理	-----------------------------------------------------






















